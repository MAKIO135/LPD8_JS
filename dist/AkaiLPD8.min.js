!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AkaiLPD8=t()}(this,function(){"use strict";class e{constructor(e){this.name=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}}class t{constructor(){this.events={}}registerEvent(t){this.events[t]=new e(t)}dispatchEvent(e,t){this.events[e].callbacks.forEach(e=>e(t))}on(e,t){this.events[e].registerCallback(t)}}class s extends t{constructor(e,t){super(),this.name=e,this.note=t,this.command=null,this.velocity=0,this.registerEvent("change")}update(e,t){this.command=e,this.velocity=t,this.dispatchEvent("change",this.velocity)}change(e){this.on("change",e)}}class n extends s{constructor(e,t){super(e,t),this.type="knob"}}class o extends s{constructor(e,t){super(e,t),this.type="pad",this.registerEvent("noteOff"),this.registerEvent("noteOn")}update(e,t){super.update(e,t),128===e?this.dispatchEvent("noteOff",this.velocity):144===e&&this.dispatchEvent("noteOn",this.velocity)}noteOff(e){this.on("noteOff",e)}noteOn(e){this.on("noteOn",e)}}navigator.requestMIDIAccess||console.error("This browser does not support WebMIDI.");const i=["K1","K2","K3","K4","K5","K6","K7","K8","PAD1","PAD2","PAD3","PAD4","PAD5","PAD6","PAD7","PAD8"],c=["1","2","3","4","5","6","7","8","36","37","38","39","40","41","42","43"];return class{constructor(e){this.log=e&&e.log||!1,this.initialized=!1}init(){return new Promise((e,t)=>{navigator.requestMIDIAccess||t(new Error("This browser does not support WebMIDI.")),navigator.requestMIDIAccess().then(s=>{this.log&&console.log({midiAccess:s});for(const t of s.inputs.values())"LPD8"===t.name&&(i.forEach((e,t)=>{this[e]=e.includes("PAD")?new o(e,c[t]):new n(e,c[t])}),t.addEventListener("midimessage",e=>{this.log&&console.log({midiMessage:e});const[t,s,n]=e.data;this.log&&console.log({note:s,command:t,velocity:n}),this[i[c.indexOf(`${s}`)]].update(t,n)}),this.initialized=!0,e());t(new Error("LPD8 not found among your MIDI devices"))},e=>{console.log({error:e}),t(new Error("Could not access your MIDI devices."))})})}}});
